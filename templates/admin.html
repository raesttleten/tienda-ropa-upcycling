<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - thriftstorecol</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">thriftstorecol · admin</a>
            <div class="nav-icons">
                <a href="/" style="width: auto; padding: 0.8rem 1.5rem; border-radius: 50px;">
                    <i class="fas fa-home"></i> Volver a la tienda
                </a>
            </div>
        </nav>
    </header>

    <main class="admin-container">
        <div class="admin-stats">
            <div class="stat-card">
                <h3>Total Productos</h3>
                <div class="numero">{{ total_productos }}</div>
            </div>
            <div class="stat-card">
                <h3>Stock Total</h3>
                <div class="numero">{{ total_stock }}</div>
            </div>
            <div class="stat-card">
                <h3>Valor Inventario</h3>
                <div class="numero">${{ valor_inventario|format_cop }} COP</div>
            </div>
        </div>

        <section class="agregar-producto">
            {% if producto_editar %}
            <h2>Editar Producto</h2>
            {% else %}
            <h2>Agregar Nueva Pieza</h2>
            {% endif %}

            <form method="POST" action="{% if producto_editar %}/admin/actualizar/{{ producto_editar.id }}{% else %}/admin/agregar{% endif %}">
                <input type="text" name="nombre" placeholder="Nombre del producto *" value="{{ producto_editar.nombre if producto_editar else '' }}" required>

                <select name="categoria" required>
                    <option value="">Seleccionar categoría *</option>
                    <option value="Camisas" {% if producto_editar and producto_editar.categoria =='Camisas' %}selected{% endif %}>Camisas</option>
                    <option value="Pantalones" {% if producto_editar and producto_editar.categoria =='Pantalones' %}selected{% endif %}>Pantalones</option>
                    <option value="Faldas" {% if producto_editar and producto_editar.categoria =='Faldas' %}selected{% endif %}>Faldas</option>
                    <option value="Bolsos" {% if producto_editar and producto_editar.categoria =='Bolsos' %}selected{% endif %}>Bolsos</option>
                    <option value="Accesorios" {% if producto_editar and producto_editar.categoria =='Accesorios' %}selected{% endif %}>Accesorios</option>
                    <option value="Otro" {% if producto_editar and producto_editar.categoria =='Otro' %}selected{% endif %}>Otro</option>
                </select>

                <input type="number" step="0.01" name="precio" placeholder="Precio (COP) *" value="{{ producto_editar.precio if producto_editar else '' }}" required>

                <select name="talla" required>
                    <option value="">Seleccionar talla *</option>
                    <option value="XS" {% if producto_editar and producto_editar.talla =='XS' %}selected{% endif %}>XS</option>
                    <option value="S" {% if producto_editar and producto_editar.talla =='S' %}selected{% endif %}>S</option>
                    <option value="M" {% if producto_editar and producto_editar.talla =='M' %}selected{% endif %}>M</option>
                    <option value="L" {% if producto_editar and producto_editar.talla =='L' %}selected{% endif %}>L</option>
                    <option value="XL" {% if producto_editar and producto_editar.talla =='XL' %}selected{% endif %}>XL</option>
                    <option value="XXL" {% if producto_editar and producto_editar.talla =='XXL' %}selected{% endif %}>XXL</option>
                    <option value="Única" {% if producto_editar and producto_editar.talla =='Única' %}selected{% endif %}>Única</option>
                </select>

                <input type="number" name="stock" placeholder="Stock disponible *" value="{{ producto_editar.stock if producto_editar else '' }}" required min="0">

                <input type="url" name="imagen_url" placeholder="URL de la imagen *" value="{{ producto_editar.imagen_url if producto_editar else '' }}" required>

                <textarea name="descripcion" placeholder="Descripción: historia de la pieza, materiales, estado, detalles especiales..." required>{{ producto_editar.descripcion if producto_editar else '' }}</textarea>

                {% if producto_editar %}
                <button type="submit" style="background: var(--light-wine);">ACTUALIZAR PRODUCTO</button>
                <a href="/admin" style="grid-column: 1 / -1; text-align: center; padding: 1rem; background: var(--medium-gray); color: var(--white); text-decoration: none; border-radius: 4px; font-weight: 600;">CANCELAR</a>
                {% else %}
                <button type="submit">AGREGAR PRODUCTO</button>
                {% endif %}
            </form>

            {% if not producto_editar %}
            <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(114, 47, 55, 0.1); border-radius: 8px; border: 1px solid var(--wine);">
                <h4 style="color: var(--light-wine); margin-bottom: 1rem;">Cómo agregar imágenes:</h4>
                <ol style="color: var(--light-gray); line-height: 1.8; padding-left: 1.5rem;">
                    <li>Sube tu foto a <a href="https://imgur.com/upload" target="_blank" style="color: var(--wine); font-weight: 600;">Imgur</a> o <a href="https://postimages.org/" target="_blank" style="color: var(--wine); font-weight: 600;">PostImages</a></li>
                    <li>Copia el enlace directo de la imagen</li>
                    <li>Pégalo en el campo "URL de la imagen"</li>
                </ol>
            </div>
            {% endif %}
        </section>

        <section class="lista-productos">
            <h2>Inventario Actual</h2>
            {% if productos %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Imagen</th>
                        <th>Nombre</th>
                        <th>Categoría</th>
                        <th>Precio</th>
                        <th>Talla</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for producto in productos %}
                    <tr>
                        <td><strong>#{{ producto.id }}</strong></td>
                        <td>
                            <img src="{{ producto.imagen_url }}" alt="{{ producto.nombre }}"
                                 style="width: 70px; height: 70px; object-fit: cover; border-radius: 4px; border: 1px solid var(--wine);"
                                 onerror="this.src='https://images.unsplash.com/photo-1445205170230-053b83016050?w=100&h=100&fit=crop'">
                        </td>
                        <td><strong>{{ producto.nombre }}</strong></td>
                        <td><span style="color: var(--light-wine);">{{ producto.categoria }}</span></td>
                        <td style="color: var(--wine); font-weight: 700; font-size: 1.1rem;">${{ producto.precio|format_cop }} COP</td>
                        <td>{{ producto.talla }}</td>
                        <td>
                            {% if producto.stock == 0 %}
                            <span style="color: #8B0000;">Agotado</span>
                            {% elif producto.stock == 1 %}
                            <span style="color: var(--light-wine);">1 (única)</span>
                            {% elif producto.stock < 3 %}
                            <span style="color: var(--light-wine);">{{ producto.stock }}</span>
                            {% else %}
                            <span style="color: var(--light-gray);">{{ producto.stock }}</span>
                            {% endif %}
                        </td>
                        <td style="white-space: nowrap;">
                            <a href="/admin/editar/{{ producto.id }}"
                               style="background: var(--wine); color: white; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none; display: inline-block; margin-right: 0.5rem; font-size: 0.85rem; font-weight: 600;">
                                Editar
                            </a>
                            <a href="/admin/eliminar/{{ producto.id }}"
                               class="btn-delete"
                               style="padding: 0.5rem 1rem; font-size: 0.85rem; display: inline-block;"
                               onclick='return confirm("¿Seguro que quieres eliminar este producto?")'>
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="text-align: center; color: var(--light-gray); padding: 3rem;">
                No hay productos. Agrega tu primera pieza vintage arriba.
            </p>
            {% endif %}
        </section>
    </main>

    <footer>
        <p>thriftstorecol · Admin Panel</p>
    </footer>
</body>
</html>